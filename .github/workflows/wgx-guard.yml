name: WGX Guard (reusable)

on:
  workflow_call: {}

jobs:
  guard:
    runs-on: ubuntu-latest
    permissions:
      contents: read
    steps:
      - name: Checkout caller repository
        uses: actions/checkout@v4

      - name: Ensure .wgx/profile.yml exists
        run: |
          if [ ! -f .wgx/profile.yml ]; then
            echo "::error::.wgx/profile.yml nicht gefunden im Caller-Repo"
            exit 1
          fi

      - name: Checkout heimgewebe/tools (WGX)
        uses: actions/checkout@v4
        with:
          repository: heimgewebe/tools
          path: .wgx-tools
          # TODO: hier eine feste Version/Tag pinnen
          ref: main

      - name: Run wgx guard
        run: |
          export WGX_TARGET_ROOT="$GITHUB_WORKSPACE"
          .wgx-tools/wgx/wgx guard
